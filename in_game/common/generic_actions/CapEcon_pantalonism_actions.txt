cap_econ_kill_pantalonism_rebels = {
    type = situation

    allow = {
        is_situation_active = situation:rise_of_pantalonism
        scope:actor = {
            any_owned_location = { any_pop = { religion = religion:pantalonism } }
        }
    }

    select_trigger = {
        looking_for_a = situation
        target_flag = recipient
        name = "choose_situation"
        column = { data = name }
        visible = {
            situation:rise_of_pantalonism = this
            situation_is_active = yes
            scope:actor = situation:rise_of_pantalonism.var:target_country
        }
    }

    ai_tick = monthly
    ai_tick_frequency = 1

    automation_tick = never
    automation_tick_frequency = 12

    effect = {
        scope:actor ?= {
            create_rebel = {
                category = religious
                religion = religion:pantalonism
                save_scope_as = target_rebel
            }

            if = {
                limit = {
                    any_owned_location = {
                        has_building = building_type:Mangiatoia
                        any_pop = { religion = religion:pantalonism }
                    }
                }
                random_owned_location = {
                    limit = {
                        has_building = building_type:Mangiatoia
                        any_pop = { religion = religion:pantalonism }
                    }
                    save_scope_as = target_location
                }
            }
            else = {
                random_owned_location = {
                    limit = { any_pop = { religion = religion:pantalonism } }
                    save_scope_as = target_location
                }
            }

            scope:target_rebel ?= { add_rebel_progress = 0.2 }
            scope:target_location ?= {
                every_pop = {
                    limit = {
                        owner = root
                        religion = religion:pantalonism
                    }
                    change_pop_allegiance = scope:target_rebel
                    add_pop_satisfaction = pop_satisfaction_weak_penalty
                }
            }
        }
    }

    ai_will_do = {
        add = -100
    }
}

cap_econ_fund_mangiatoia = {
    type = situation

    allow = {
        is_situation_active = situation:rise_of_pantalonism
        scope:actor = {
            religion = religion:pantalonism
        }
    }

    select_trigger = {
        looking_for_a = situation
        target_flag = recipient
        name = "choose_situation"
        column = { data = name }
        visible = {
            situation:rise_of_pantalonism = this
            situation_is_active = yes
            scope:actor = { religion = religion:pantalonism }
        }
    }

    ai_tick = monthly
    ai_tick_frequency = 1

    automation_tick = never
    automation_tick_frequency = 12

    effect = {
        situation:rise_of_pantalonism.var:target_country ?= {
            random_owned_location = {
                construct_building = {
                    building_type = building_type:Pantalonism_assembly
                    owner = scope:actor

                }
            }

        }
    }

    ai_will_do = {
        add = 10
        if = {
            limit = { scope:actor = { gold > 200 } }
            add = 50
        }
        if = {
            limit = { scope:actor = { gold < 200 } }
            subtract = 50
        }
    }
}

cap_econ_fund_mangiatoia_foreign = {
    type = situation

    allow = {
        is_situation_active = situation:rise_of_pantalonism
        scope:actor = {
            religion = religion:pantalonism
        }
    }

    select_trigger = {
        looking_for_a = situation
        target_flag = recipient
        name = "choose_situation"
        column = { data = name }
        visible = {
            situation:rise_of_pantalonism = this
            situation_is_active = yes
            scope:actor = { religion = religion:pantalonism }
        }
    }

    ai_tick = monthly
    ai_tick_frequency = 6
    show_message_to_target = yes
    automation_tick = never
    automation_tick_frequency = 12

    effect = {
        situation:rise_of_pantalonism.var:target_country ?= {
            random_owned_location = {
                limit = {
                    OR = { is_town = yes is_city = yes }
                    "location_building_level(building_type:Mangiatoia_foreign)" < 10
                }
                construct_building = {
                    building_type = building_type:Mangiatoia_foreign
                    owner = scope:actor
                }
            }
        }
    }

    ai_will_do = {
        add = 10
        if = {
            limit = { scope:actor = { gold > 500 } }
            add = 50
        }
        if = {
            limit = { scope:actor = { gold > 1000 } }
            add = 1000
        }
        if = {
            limit = { scope:actor = { gold < 500 } }
            subtract = 100
        }
    }
}


cap_econ_bribe_the_estate = {
    type = situation

    allow = {
        is_situation_active = situation:rise_of_pantalonism
        scope:actor = {
            religion = religion:pantalonism
        }
        gold >= 1000
    }

    select_trigger = {
        looking_for_a = situation
        target_flag = recipient
        name = "choose_situation"
        column = { data = name }
        visible = {
            situation:rise_of_pantalonism = this
            situation_is_active = yes
            scope:actor = { religion = religion:pantalonism }
        }
    }

    ai_tick = monthly
    ai_tick_frequency = 1

    automation_tick = never
    automation_tick_frequency = 12

  effect = {
        scope:actor ?= { add_gold = { value = -1000 } }
        situation:rise_of_pantalonism.var:target_country ?= {
             create_relation = {
                  type = relation_type:cap_econ_extraction_rights
                  first = situation:rise_of_pantalonism.var:target_country
                  second =scope:actor
              }
                add_gold_to_estate = {
                        estate_type = estate_type:burghers_estate
                        value = 1000
                }
        }
  }
    ai_will_do = {
        add = 20
        if = {
            limit = {
                receiving_scripted_relation = {
                    target = situation:rise_of_pantalonism.var:target_country
                    type = relation_type:cap_econ_extraction_rights
                }
            }
            subtract = 1000
        }
        if = {
            limit = { scope:actor = { gold > 5000 } }
            add = 200
        }
        if = {
            limit = { scope:actor = { gold < 2000 } }
            subtract = 50
        }
    }
}
