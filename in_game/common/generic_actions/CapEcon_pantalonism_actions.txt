cap_econ_kill_pantalonism_rebels = {
    type = situation

    allow = {
        is_situation_active = situation:rise_of_pantalonism
        scope:actor = {
            any_owned_location = { any_pop = { religion = religion:pantalonism } }
        }
    }

    select_trigger = {
        looking_for_a = situation
        target_flag = recipient
        name = "choose_situation"
        column = { data = name }
        visible = {
            situation:rise_of_pantalonism = this
            situation_is_active = yes
            scope:actor = situation:rise_of_pantalonism.var:target_country
        }
    }

    effect = {
        scope:actor ?= {
            create_rebel = {
                category = religious
                religion = religion:pantalonism
                save_scope_as = target_rebel
            }

            if = {
                limit = {
                    any_owned_location = {
                        has_building = building_type:Mangiatoia
                        any_pop = { religion = religion:pantalonism }
                    }
                }
                random_owned_location = {
                    limit = {
                        has_building = building_type:Mangiatoia
                        any_pop = { religion = religion:pantalonism }
                    }
                    save_scope_as = target_location
                }
            }
            else = {
                random_owned_location = {
                    limit = { any_pop = { religion = religion:pantalonism } }
                    save_scope_as = target_location
                }
            }

            scope:target_rebel ?= { add_rebel_progress = 0.2 }
            scope:target_location ?= {
                every_pop = {
                    limit = {
                        owner = root
                        religion = religion:pantalonism
                    }
                    change_pop_allegiance = scope:target_rebel
                    add_pop_satisfaction = pop_satisfaction_weak_penalty
                }
            }
        }
    }

    ai_will_do = {
        add = -100
    }
}

cap_econ_fund_mangiatoia = {
    type = situation

    allow = {
        is_situation_active = situation:rise_of_pantalonism
        scope:actor = {
            religion = religion:pantalonism
        }
    }

    select_trigger = {
        looking_for_a = situation
        target_flag = recipient
        name = "choose_situation"
        column = { data = name }
        visible = {
            situation:rise_of_pantalonism = this
            situation_is_active = yes
            scope:actor = { religion = religion:pantalonism }
        }
    }

    effect = {
        situation:rise_of_pantalonism.var:target_country ?= {
            random_owned_location = {
                limit = { OR = { is_town = yes is_city = yes } }
                construct_building = {
                    building_type = building_type:Pantalonism_assembly
                    owner = scope:actor

                }
            }

        }
    }

    ai_will_do = {
        base = 10
        modifier = {
            factor = 5 
            gold > 200
            
        }
        modifier = {
            factor = -5
            gold < 50
            }
        
    }
}


cap_econ_bribe_the_estate = {
    type = situation

    allow = {
        is_situation_active = situation:rise_of_pantalonism
        scope:actor = {
            religion = religion:pantalonism
        }
        gold >= 1000
    }

    select_trigger = {
        looking_for_a = situation
        target_flag = recipient
        name = "choose_situation"
        column = { data = name }
        visible = {
            situation:rise_of_pantalonism = this
            situation_is_active = yes
            scope:actor = { religion = religion:pantalonism }
        }
    }

  effect = {
        scope:actor ?= { add_gold = { value = -1000 } }
        situation:rise_of_pantalonism.var:target_country ?= {
             create_relation = {
                  type = relation_type:cap_econ_extraction_rights
                  first = situation:rise_of_pantalonism.var:target_country
                  second =scope:actor
              }
                add_gold_to_estate = {
                        estate_type = estate_type:burghers_estate
                        value = 1000
                }
        }
  }
    ai_will_do = {
        base = 20
        modifier = {
            factor = -1000
            receiving_scripted_relation = { target = situation:rise_of_pantalonism.var:target_country type =  relation_type:cap_econ_extraction_rights}
        }
        
        modifier = {
            factor = 5 
            gold > 5000
            
        }
        modifier = {
            factor = -10
            gold < 2000
        }
    }
}