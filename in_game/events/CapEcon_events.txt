namespace = cap_econ



cap_econ.1 = {
	type = country_event

	title = cap_econ.1.title
	desc = cap_econ.1.desc
	illustration_tags = {
		10 = interior
		10 = happy
	}

	trigger = {
		AND = {
			receiving_scripted_relation_of_type = relation_type:cap_econ_send_pantalone
			giving_scripted_relation_of_type = relation_type:cap_econ_extraction_rights
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
	}

	option = {
		name = cap_econ.1.a
		custom_tooltip = cap_econ.1.a.tt
		add_gold = { value = root.estate_tax_base:burghers_estate	multiply = 10 }
		#add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_extreme_bonus	}
		add_gold_to_estate = {
			estate_type = estate_type:burghers_estate
			value = { value = root.estate_tax_base:burghers_estate multiply = 10	}
		}
		random_owned_non_rural_location = {
			change_building_level_in_location = {
				building = building_type:Mangiatoia
				value = 1
			}
		}
		hidden_effect = {
		}
	}
	option = {
		name = cap_econ.1.b
		custom_tooltip = cap_econ.1.b.tt
		add_gold = { value = root.estate_tax_base:burghers_estate	multiply = 20 }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_mild_bonus	}
		add_gold_to_estate = {
			estate_type = estate_type:burghers_estate
			value = { value = root.estate_tax_base:burghers_estate multiply = 5	}
		}
		random_owned_non_rural_location = {
			change_building_level_in_location = {
				building = building_type:Mangiatoia
				value = 1
			}
		}
			random_owned_location = {
			change_building_level_in_location = {
				building = building_type:Mangiatoia
				value = 1
			}
		}
			random_owned_location = {
			change_building_level_in_location = {
				building = building_type:Mangiatoia
				value = 1
			}
		}
		hidden_effect = {
		}
	}

}

cap_econ.5 = {
	type = country_event

	title = cap_econ.5.title
	desc = cap_econ.5.desc
	illustration_tags = {
		10 = interior
		10 = happy
	}
	trigger = {
		AND = {
			receiving_scripted_relation_of_type = relation_type:cap_econ_send_pantalone
			NOT = { has_variable = cap_econ_pantalone_arrived }
			any_owned_location = {
				is_town = yes
			}
		}
	}


 	immediate = {
 	      random_country = {
 	              limit = {
 	                      giving_scripted_relation = {
 	                              type = relation_type:cap_econ_send_pantalone
 	                              target = root
 	                      }
 	              }
 	              save_scope_as = pantalone_sender
 	      }
 	      set_variable = { name = cap_econ_pantalone_arrived value = yes }
 	}


	option = {
		name = cap_econ.5.a
		custom_tooltip = cap_econ.5.a.tt
		every_owned_location = {
			limit = {
				OR = {
					is_town = yes
					is_city = yes
				}
			}
			change_building_level_in_location = {
				building = building_type:Mangiatoia
				value = 1
			}
		}
	}
}

cap_econ.6 = {
	type = country_event

	title = cap_econ.6.title
	desc = cap_econ.6.desc
	illustration_tags = {
		10 = interior
		10 = happy
	}

	trigger = {
			receiving_scripted_relation_of_type = relation_type:cap_econ_send_pantalone
	}

	option = {
		name = cap_econ.6.a
		custom_tooltip = cap_econ.6.a.tt
		random_owned_location = {
			limit = { OR = { is_town = yes is_city = yes } }
			change_building_level_in_location = {
				building = building_type:library
				value = 1
			}
		}
	}
}

cap_econ.7 = {
	type = country_event

	title = cap_econ.7.title
	desc = cap_econ.7.desc
	illustration_tags = {
		10 = interior
		10 = happy
	}

	trigger = {
		AND = {
			receiving_scripted_relation_of_type = relation_type:cap_econ_send_pantalone
			any_owned_location = {
				is_rural_settlement = yes
			}
		}
	}

	option = {
		name = cap_econ.7.a
		custom_tooltip = cap_econ.7.a.tt
		random_owned_location = {
			limit = { is_rural_settlement = yes }
			change_location_rank = location_rank:town
		}
		random_owned_location = {
			limit = { is_rural_settlement = yes }
			change_location_rank = location_rank:town
		}
	}
}

cap_econ.8 = {
	type = country_event

	title = cap_econ.8.title
	desc = cap_econ.8.desc
	illustration_tags = {
		10 = interior
		10 = happy
	}

	trigger = {
		AND = {
			receiving_scripted_relation_of_type = relation_type:cap_econ_send_pantalone
			any_owned_location = {
				is_rural_settlement = yes
			}
		}

	}

	option = {
		name = cap_econ.8.a
		custom_tooltip = cap_econ.8.a.tt
		random_owned_location = {
			limit = { is_rural_settlement = yes }
			change_location_rank = location_rank:town
		}
	}
}

cap_econ.9 = {
	type = country_event

	title = cap_econ.9.title
	desc = cap_econ.9.desc
	illustration_tags = {
		10 = interior
		10 = happy
	}

	trigger = {
		AND = {
			receiving_scripted_relation_of_type = relation_type:cap_econ_send_pantalone
			any_owned_location = {
							is_town = yes
			}
		}
	}

	option = {
		name = cap_econ.9.a
		custom_tooltip = cap_econ.9.a.tt
		random_owned_location = {
			limit = { is_town = yes }
			change_location_rank = location_rank:city
		}
	}
}

cap_econ.20 = {
	type = country_event
	category = situation_event

	title = cap_econ.20.title
	desc = cap_econ.20.des`c
	image = "gfx/interface/illustrations/situation/reformation.dds"

  trigger = {
        situation:rise_of_pantalonism = {
                var:pantalone_happiness_modifier < 0
        }
  }

	option = {
		name = cap_econ.20.a
		custom_tooltip = cap_econ.20.a.tt
		every_estate = {
			limit = {
				estate_type = estate_type:peasants_estate
			}

            estate_add_gold = {
				value = root.country_tax_base
			}
	}
		add_estate_satisfaction = {
			type = estate_type:peasants_estate
			value = -0.3
		}
		every_pop = {
			limit = {
				pop_type = pop_type:peasants
				religion != religion:pantalonism
			}
			split_pop = {
				fraction = 0.01
				religion = religion:pantalonism
			}
		}
	}
}

cap_econ.21 = {
	type = country_event
	category = situation_event

	title = cap_econ.21.title
	desc = cap_econ.21.desc
	image = "gfx/interface/illustrations/situation/reformation.dds"

	trigger = {
		always = no
	}

	option = {
		name = cap_econ.21.a
		custom_tooltip = cap_econ.21.a.tt
		hidden_effect = {
			situation:rise_of_pantalonism = {
				change_variable = { name = pantalonism_progress add = -5 }
			}
		}
	}
}

cap_econ.22 = {
	type = country_event

	title = cap_econ.22.title
	desc = cap_econ.22.desc
	image = "gfx/interface/illustrations/situation/reformation.dds"

	trigger = {
	}

	option = {
		name = cap_econ.22.a
		set_variable = { name = cap_econ_force_pantalonism_situation value = 1 }
		activate_situation = situation:rise_of_pantalonism
	}
}

cap_econ.23 = {
	type = country_event
	category = situation_event

	title = cap_econ.23.title
	desc = cap_econ.23.desc
	image = "gfx/interface/illustrations/situation/reformation.dds"



	option = {
		name = cap_econ.23.a
		custom_tooltip = cap_econ.23.a.tt

		ai_will_select = {
			base = 1
			modifier = {
				factor = 3
				stability < 0
			}
		}


		every_owned_location = {
				every_pop = {
 				limit = {
 				      AND = {
 				              religion != religion:pantalonism
 				              pop_type != pop_type:clergy
 				      }
 				}
				split_pop = {
					fraction = 0.1
					religion = religion:pantalonism
				}
			}
		}
	}

	option = {
		name = cap_econ.23.b
		custom_tooltip = cap_econ.23.b.tt

		add_stability = -10


		ai_will_select = {
			base = 1
			modifier = {
				factor = 3
				stability > 10
			}
		}
		every_owned_location = {
			limit = {
				#whre there is a mangiatoia
				has_building_with_at_least_one_level = Mangiatoia
			}
			add_location_modifier = {
				modifier = cap_econ_repression
				years = 1
				mode = add_and_extend
			}
		}
		situation:rise_of_pantalonism = {
			       change_variable = { name = pantalone_happiness_modifier add = -1 }
			 }
		}
	}


cap_econ.24 = {
	type = country_event
	category = situation_event

	title = cap_econ.24.title
	desc = cap_econ.24.desc
	image = "gfx/interface/illustrations/situation/reformation.dds"

	trigger = {
		always = no
	}

	option = {
		name = cap_econ.24.a
		custom_tooltip = cap_econ.24.a.tt
		every_owned_location = {
			limit = { has_building_with_at_least_one_level = Mangiatoia }
			set_variable = {
				name = cap_econ_mangiatoia_loc_fraction
				value = "location_building_level(building_type:Mangiatoia)"
			}
			change_variable = { name = cap_econ_mangiatoia_loc_fraction multiply = 0.005 }
			every_pop = {
				limit = { religion != religion:pantalonism }
				split_pop = {
					fraction = var:cap_econ_mangiatoia_loc_fraction
					religion = religion:pantalonism
				}
			}
			remove_variable = cap_econ_mangiatoia_loc_fraction
		}
	}
}

cap_econ.25 = {
	type = country_event

	title = cap_econ.25.title
	desc = cap_econ.25.desc
	illustration_tags = {
		10 = interior
		10 = angry
	}

	trigger = {
		receiving_scripted_relation_of_type = relation_type:cap_econ_send_pantalone
	}

	immediate = {
		random_country = {
			limit = {
				giving_scripted_relation = {
					type = relation_type:cap_econ_send_pantalone
					target = root
				}
			}
			save_scope_as = pantalone_sender
		}
	}

option = {
        name = cap_econ.25.a
        custom_tooltip = cap_econ.25.a.tt

        random_owned_location = {
                limit = { OR = { is_town = yes is_city = yes } }
                change_building_level_in_location = {
                        building = building_type:Mangiatoia
                        value = 1
                }
        }
        random_owned_location = {
                limit = { OR = { is_town = yes is_city = yes } }
                change_building_level_in_location = {
                        building = building_type:Mangiatoia
                        value = 1
                }
        }
        random_owned_location = {
                limit = { OR = { is_town = yes is_city = yes } }
                change_building_level_in_location = {
                        building = building_type:Mangiatoia
                        value = 1
                }
        }


                scope:pantalone_sender ?= {
                        trigger_event_non_silently = cap_econ.26
                        add_gold = { value = 300 }
                }

  }

	}


cap_econ.26 = {
	type = country_event

	title = cap_econ.26.title
	desc = cap_econ.26.desc
	illustration_tags = {
		10 = interior
		10 = unhappy
	}

	trigger = {
	}


  option = {
        name = cap_econ.26.a
        custom_tooltip = cap_econ.26.a.tt
        add_gold = { value = -500 }
        scope:cap_econ_pantalone_coup_target ?= {
                set_variable = cap_econ_force_pantalonism_situation
        }

        random_country = {
                limit = {
                        receiving_scripted_relation = {
                                type = relation_type:cap_econ_send_pantalone
                                target = root
                        }
                }
                save_scope_as = pantalone_receiver
        }

        scope:pantalone_receiver ?= {
                trigger_event_non_silently = cap_econ.22
        }
        remove_variable = cap_econ_pantalone_coup_target
  }
}
